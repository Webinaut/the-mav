---
// src/components/ViewCounter.astro
import { db, admin } from "../scripts/firebase";

const { slug } = Astro.props;
let views = 0;
// console.log("slug: ", { slug });
try {
  const docRef = db.collection("views").doc(slug);

  // Increment
  await docRef.set(
    { count: admin.firestore.FieldValue.increment(1) },
    { merge: true },
  );

  // Fetch
  const doc = await docRef.get();
  views = doc.exists ? doc.data()?.count : 1;
} catch (e) {
  console.error("Firebase Error:", e);
}
---
